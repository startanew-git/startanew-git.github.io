<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>JAVA • Posts by &#34;运维&#34; category</title>
        <link>http://www.startanew.cn</link>
        <description>爱编程，爱生活</description>
        <language>zh-CN</language>
        <pubDate>Sun, 25 Jul 2021 17:09:18 +0800</pubDate>
        <lastBuildDate>Sun, 25 Jul 2021 17:09:18 +0800</lastBuildDate>
        <category>java</category>
        <category>springboot</category>
        <category>javaweb</category>
        <category>javascript</category>
        <category>MYSQL</category>
        <category>redis</category>
        <category>其他</category>
        <category>docker</category>
        <category>dos命令</category>
        <category>git</category>
        <category>android</category>
        <category>maven</category>
        <category>mysql</category>
        <category>spring-sceurity</category>
        <category>webrtc</category>
        <category>员工关系管理</category>
        <category>近代史</category>
        <category>工作分析</category>
        <category>树莓派</category>
        <category>tinc</category>
        <category>other</category>
        <category>云真机</category>
        <category>linux</category>
        <item>
            <guid isPermalink="true">http://www.startanew.cn/2021/07/25/%E5%AE%89%E8%A3%85harbor/</guid>
            <title>安装harbor</title>
            <link>http://www.startanew.cn/2021/07/25/%E5%AE%89%E8%A3%85harbor/</link>
            <category>other</category>
            <pubDate>Sun, 25 Jul 2021 17:09:18 +0800</pubDate>
            <description><![CDATA[ &lt;h5 id=&#34;下载harbor&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#下载harbor&#34;&gt;#&lt;/a&gt; 下载 harbor&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;wget https://github.com/goharbor/harbor/releases/download/v1.9.4/harbor-offline-installer-v1.9.4.tgz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tar -xf harbor-offline-installer-v1.9.4.tgz  -C /opt/harbor&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;修改配置文件&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#修改配置文件&#34;&gt;#&lt;/a&gt; 修改配置文件&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vim /opt/harbor/harbor.yml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;harbor_admin_password:  # 登录密码&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;location:  #日志文件目录&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;安装-docker-compose-已安装docker&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#安装-docker-compose-已安装docker&#34;&gt;#&lt;/a&gt; 安装 docker-compose (已安装 docker)&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;yum install -y docker-compose &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;安装失败可以使用以下方式安装&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;wget  https://github.com/docker/compose/releases/download/1.29.2/docker-compose-Linux-x86_64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mv  docker-compose-Linux-x86_64  /usr/local/bin/docker-compose&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cd /usr/local/bin/; chmod +x docker-compose&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;进入目录开始安装&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#进入目录开始安装&#34;&gt;#&lt;/a&gt; 进入目录开始安装&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cd /opt/harbor/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;./install.sh&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;查看&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#查看&#34;&gt;#&lt;/a&gt; 查看&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;docker-compose ps &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      Name                     Command                  State                     Ports&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;------------------------------------------------------------------------------------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;harbor-core         /harbor/start.sh                 Up (healthy)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;harbor-db           /entrypoint.sh postgres          Up (healthy)   5432/tcp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;harbor-jobservice   /harbor/start.sh                 Up&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;harbor-log          /bin/sh -c /usr/local/bin/ ...   Up (healthy)   127.0.0.1:1514-&amp;gt;10514/tcp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;harbor-portal       nginx -g daemon off;             Up (healthy)   80/tcp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nginx               nginx -g daemon off;             Up (healthy)   0.0.0.0:180-&amp;gt;80/tcp,:::180-&amp;gt;80/tcp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;redis               docker-entrypoint.sh redis ...   Up             6379/tcp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;registry            /entrypoint.sh /etc/regist ...   Up (healthy)   5000/tcp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;registryctl         /harbor/start.sh                 Up (healthy)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;测试harbor-1921683125-harbor地址&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#测试harbor-1921683125-harbor地址&#34;&gt;#&lt;/a&gt; 测试 harbor (192.168.31.25  harbor 地址)&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;docker pull nginx:1.7.9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;docker tag nginx:1.7.9  192.168.31.25/public/nginx:v1.7.9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;docker login -u admin harbor.od.com&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;docker push 192.168.31.25/public/nginx:v1.7.9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;访问 192.168.31.25  进行查看&lt;/p&gt;
&lt;/blockquote&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://www.startanew.cn/2021/07/25/k8s%20%20%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85/</guid>
            <title>k8s 二进制安装</title>
            <link>http://www.startanew.cn/2021/07/25/k8s%20%20%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85/</link>
            <category>other</category>
            <pubDate>Sun, 25 Jul 2021 17:09:18 +0800</pubDate>
            <description><![CDATA[ &lt;h5 id=&#34;集群架构-学习记录&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#集群架构-学习记录&#34;&gt;#&lt;/a&gt; 集群架构  (学习记录)&lt;/h5&gt;
&lt;blockquote&gt;
&lt;p&gt;两个 master 两个 node&lt;br&gt;
192.168.31.1 etcd&lt;br&gt;
192.168.31.2 master node etcd&lt;br&gt;
192.168.31.3 master node etcd&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5 id=&#34;基础环境设置&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#基础环境设置&#34;&gt;#&lt;/a&gt; 基础环境设置&lt;/h5&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;设置主机名&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;主机ip:192.168.31.1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;hostnamectl set-hostname etcd1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;主机ip:192.168.31.2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;hostnamectl set-hostname k8s2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;主机ip:192.168.31.3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;hostnamectl set-hostname k8s3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;关闭防火墙和 selinux&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;systemctl stop firewalld&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;systemctl disable firewalld&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;setenforce 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sed -i &amp;quot;s/SELINUX=enforcing/SELINUX=disabled/g&amp;quot; /etc/selinux/config&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;设置 yum 源&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;wget -O /etc/yum.repos.d/CentOS-Base.repo  http://mirrors.aliyun.com/repo/Centos-7.repo&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;wget -O /etc/yum.repos.d/epel.repo  http://mirrors.aliyun.com/repo/epel-7.repo&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;yum clean all&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;yum makecache&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;常用工具安装&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;yum install wget net-tools telnet tree nmap sysstat lrzsz dos2unix bind-utils -y&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;安装 cfssl （签发证书使用）&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 -O /usr/bin/cfssl&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;wget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64 -O /usr/bin/cfssl-json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;wget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64 -O /usr/bin/cfssl-certinfo&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;chmod +x /usr/bin/cfssl*&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;生成根证书&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt; mkdir /opt/certs/; cd /opt/certs/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vim /opt/certs/ca-csr.json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; cat /opt/certs/ca-csr.json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;CN&amp;quot;: &amp;quot;kubernetes&amp;quot;,  #浏览器使用该字段验证网站是否合法，一般写的是域名&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;hosts&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    ],&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;key&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;algo&amp;quot;: &amp;quot;rsa&amp;quot;, #生成证书的算法&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;size&amp;quot;: 2048&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;names&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;C&amp;quot;: &amp;quot;CN&amp;quot;,  # 国家&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;ST&amp;quot;: &amp;quot;jiangsu&amp;quot;, #州或者是省份&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;L&amp;quot;: &amp;quot;jiangsu&amp;quot;, #地区，城市&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;O&amp;quot;: &amp;quot;k8s&amp;quot;, #组织名称，公司名称&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;OU&amp;quot;: &amp;quot;System&amp;quot; #组织单位名称，公司部门&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    ],&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;ca&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;expiry&amp;quot;: &amp;quot;175200h&amp;quot;  # 过期时间（20年）&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; cfssl gencert -initca ca-csr.json | cfssl-json -bare ca&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ls -l ca*&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;安装 docker&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;yum install -y docker-ce&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vim /etc/docker/daemon.json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;设置个人镜像仓库&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;insecure-registries&amp;quot;: [&amp;quot;仓库地址&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;  开启docker&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; systemctl start docker ; systemctl enable docker&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;8&#34;&gt;
&lt;li&gt;设置时区&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;etcd安装&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#etcd安装&#34;&gt;#&lt;/a&gt; etcd 安装&lt;/h5&gt;
&lt;blockquote&gt;
&lt;p&gt;etcd 地址：&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL2V0Y2QtaW8vZXRjZC8=&#34;&gt;https://github.com/etcd-io/etcd/&lt;/span&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;创建 ca 的 json 配置&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;signing&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;default&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;expiry&amp;quot;: &amp;quot;175200h&amp;quot;  #过期时间&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;profiles&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          #表示服务端连接客户端时携带的证书，用于客户端验证服务端身份  server可以自定义&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;server&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &amp;quot;expiry&amp;quot;: &amp;quot;175200h&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &amp;quot;usages&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &amp;quot;signing&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &amp;quot;key encipherment&amp;quot;,    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &amp;quot;server auth&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                ]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            #表示客户端连接服务端时携带的证书，用于服务端验证客户端身份 client可以自定义&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;client&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &amp;quot;expiry&amp;quot;: &amp;quot;175200h&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &amp;quot;usages&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &amp;quot;signing&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &amp;quot;key encipherment&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &amp;quot;client auth&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                ]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            #表示相互之间连接时使用的证书，如etcd节点之间验证&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;peer&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &amp;quot;expiry&amp;quot;: &amp;quot;175200h&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &amp;quot;usages&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &amp;quot;signing&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &amp;quot;key encipherment&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &amp;quot;server auth&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &amp;quot;client auth&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                ]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;创建 etcd 证书配置 (因 etcd 采用集群方式部署，需要 server auth 与 client auth，使用采用 peer 生成证书)&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;CN&amp;quot;: &amp;quot;k8s-etcd&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;hosts&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;192.168.31.1&amp;quot;, #集群的ip列表&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;192.168.31.2&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;192.168.31.3&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    ],&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;key&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;algo&amp;quot;: &amp;quot;rsa&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;size&amp;quot;: 2048&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;names&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;C&amp;quot;: &amp;quot;CN&amp;quot;,  # 国家&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;ST&amp;quot;: &amp;quot;jiangsu&amp;quot;, #州或者是省份&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;L&amp;quot;: &amp;quot;jiangsu&amp;quot;, #地区，城市&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;O&amp;quot;: &amp;quot;k8s&amp;quot;, #组织名称，公司名称&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;OU&amp;quot;: &amp;quot;System&amp;quot; #组织单位名称，公司部门&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    ]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;签发证书&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=peer etcd-peer-csr.json |cfssl-json -bare etcd-peer&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ll etcd-peer*&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;安装 etcd&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;创建用户&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;useradd -s /sbin/nologin -M etcd&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;下载安装包&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;wget https://github.com/etcd-io/etcd/releases/download/v3.1.20/etcd-v3.1.20-linux-amd64.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tar -xf etcd-v3.1.20-linux-amd64.tar.gz &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mv etcd-v3.1.20-linux-amd64 /opt/etcd&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;将  ca.pem etcd-peer.pem etcd-peer-key.pem  发送到三台机器上  目录 /opt/etcd/certs/&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;创建启动脚本&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vim /opt/etcd/etcd-server-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /opt/etcd/etcd-server-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;!/bin/sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/opt/etcd/etcd --name etcd-server-31-1 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --data-dir /data/etcd/etcd-server \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --listen-peer-urls https://192.168.31.1:2380 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --listen-client-urls https://192.168.31.1:2379,http://127.0.0.1:2379 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --quota-backend-bytes 8000000000 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --initial-advertise-peer-urls https://192.168.31.1:2380 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --advertise-client-urls https://192.168.31.1:2379,http://127.0.0.1:2379 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --initial-cluster  etcd-server-31-1=https://192.168.31.1:2380,etcd-server-31-2=https://192.168.31.2:2380,etcd-server-31-3=https://192.168.31.3:2380 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --ca-file ./certs/ca.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --cert-file ./certs/etcd-peer.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --key-file ./certs/etcd-peer-key.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --client-cert-auth  \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --trusted-ca-file ./certs/ca.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --peer-ca-file ./certs/ca.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --peer-cert-file ./certs/etcd-peer.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --peer-key-file ./certs/etcd-peer-key.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --peer-client-cert-auth \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --peer-trusted-ca-file ./certs/ca.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --log-output stdout&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;给予运行权限&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;chmod u+x /opt/etcd/etcd-server-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;chown -R etcd.etcd /opt/etcd/ /data/etcd /data/logs/etcd-server&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;启动 etcd&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; 使用supervisor启动脚本&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;安装&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;yum install -y supervisor&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;systemctl start supervisord ; systemctl enable supervisord&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;编写启动脚本配置文件&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vim /etc/supervisord.d/etcd-server.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /etc/supervisord.d/etcd-server.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[program:etcd-server-31-1]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;command=/opt/etcd/etcd-server-startup.sh              ; the program (relative uses PATH, can take args)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;numprocs=1                                            ; number of processes copies to start (def 1)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;directory=/opt/etcd                                   ; directory to cwd to before exec (def no cwd)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;autostart=true                                        ; start at supervisord start (default: true)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;autorestart=true                                      ; retstart at unexpected quit (default: true)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;startsecs=30                                          ; number of secs prog must stay running (def. 1)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;startretries=3                                        ; max # of serial start failures (default 3)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;exitcodes=0,2                                         ; &amp;#x27;expected&amp;#x27; exit codes for process (default 0,2)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stopsignal=QUIT                                       ; signal used to kill process (default TERM)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stopwaitsecs=10                                       ; max num secs to wait b4 SIGKILL (default 10)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;user=etcd                                             ; setuid to this UNIX account to run the program&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;redirect_stderr=true                                  ; redirect proc stderr to stdout (default false)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile=/data/logs/etcd-server/etcd.stdout.log ; stdout log path, NONE for none; default AUTO&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile_maxbytes=64MB                          ; max # logfile bytes b4 rotation (default 50MB)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile_backups=5                              ; # of stdout logfile backups (default 10)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_capture_maxbytes=1MB                           ; number of bytes in &amp;#x27;capturemode&amp;#x27; (default 0)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_events_enabled=false                           ; emit events on stdout writes (default false)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;配置文件更新后，使用supervisorctl update,使配置生效&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;supervisorctl status  # supervisorctl 状态&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;supervisorctl start  xxx  # 运行某个脚本&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;supervisorctl stop  xxx  # 停止运行某个脚本&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;supervisorctl restart  xxx  # 重新运行某个脚本&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;其他两台跟第一台一样安装， 只需要修改 ip 地址&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;查看集群&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;/opt/etcd/etcdctl member list&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/opt/etcd/etcdctl cluster-health&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;安装apiserver&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#安装apiserver&#34;&gt;#&lt;/a&gt; 安装 apiserver&lt;/h5&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;下载安装包&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;下载地址:https://github.com/kubernetes/kubernetes&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tar -xf kubernetes-server-linux-amd64.tar.gz &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mv kubernetes /opt/kubernetes&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;签发证书&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; 签发 apiserver和etcd通信证书  客户端证书&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vim /opt/certs/client-csr.json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /opt/certs/client-csr.json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;CN&amp;quot;: &amp;quot;k8s-node&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;hosts&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    ],&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;key&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;algo&amp;quot;: &amp;quot;rsa&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;size&amp;quot;: 2048&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;names&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;C&amp;quot;: &amp;quot;CN&amp;quot;,  # 国家&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;ST&amp;quot;: &amp;quot;jiangsu&amp;quot;, #州或者是省份&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;L&amp;quot;: &amp;quot;jiangsu&amp;quot;, #地区，城市&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;O&amp;quot;: &amp;quot;k8s&amp;quot;, #组织名称，公司名称&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;OU&amp;quot;: &amp;quot;System&amp;quot; #组织单位名称，公司部门&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    ]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client client-csr.json |cfssl-json -bare client&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;签发 server 证书（apiserver 和其它 k8s 组件通信使用）&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt; vim /opt/certs/apiserver-csr.json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; cat /opt/certs/apiserver-csr.json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;CN&amp;quot;: &amp;quot;k8s-apiserver&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;hosts&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;127.0.0.1&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;192.168.0.1&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;kubernetes.default&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;kubernetes.default.svc&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;kubernetes.default.svc.cluster&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;kubernetes.default.svc.cluster.local&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;192.168.31.2&amp;quot;,  #所有apiserver ip&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;192.168.31.3&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    ],&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;key&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;algo&amp;quot;: &amp;quot;rsa&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;size&amp;quot;: 2048&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;names&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;C&amp;quot;: &amp;quot;CN&amp;quot;,  # 国家&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;ST&amp;quot;: &amp;quot;jiangsu&amp;quot;, #州或者是省份&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;L&amp;quot;: &amp;quot;jiangsu&amp;quot;, #地区，城市&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;O&amp;quot;: &amp;quot;k8s&amp;quot;, #组织名称，公司名称&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;OU&amp;quot;: &amp;quot;System&amp;quot; #组织单位名称，公司部门&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    ]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;签发证书&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server apiserver-csr.json |cfssl-json -bare apiserver&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;将apiserver-key.pem apiserver.pem ca-key.pem ca.pem client-key.pem client.pem 复制到每个apiserver主机的/opt/kubernetes/server/bin/certs/目录&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;4. 配置 apiserver 日志审计&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;71&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;mkdir /opt/kubernetes/conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vim /opt/kubernetes/conf/audit.yaml &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /opt/kubernetes/conf/audit.yaml &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: audit.k8s.io/v1beta1 # This is required.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: Policy&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; Don&lt;span class=&#34;string&#34;&gt;&amp;#x27;t generate audit events for all requests in RequestReceived stage.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;omitStages:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - &amp;quot;RequestReceived&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rules:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;  #&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; Log pod changes at RequestResponse level&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - level: RequestResponse&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - group: &amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      # Resource &amp;quot;pods&amp;quot; doesn&amp;#x27;t match requests to any subresource of pods,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      # which is consistent with the RBAC policy.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      resources: [&amp;quot;pods&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;  #&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; Log &lt;span class=&#34;string&#34;&gt;&amp;quot;pods/log&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;pods/status&amp;quot;&lt;/span&gt; at Metadata level&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - level: Metadata&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - group: &amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      resources: [&amp;quot;pods/log&amp;quot;, &amp;quot;pods/status&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;  #&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; Don&lt;span class=&#34;string&#34;&gt;&amp;#x27;t log requests to a configmap called &amp;quot;controller-leader&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - level: None&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - group: &amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      resources: [&amp;quot;configmaps&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      resourceNames: [&amp;quot;controller-leader&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;  #&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; Don&lt;span class=&#34;string&#34;&gt;&amp;#x27;t log watch requests by the &amp;quot;system:kube-proxy&amp;quot; on endpoints or services&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - level: None&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    users: [&amp;quot;system:kube-proxy&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    verbs: [&amp;quot;watch&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - group: &amp;quot;&amp;quot; # core API group&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      resources: [&amp;quot;endpoints&amp;quot;, &amp;quot;services&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;  #&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; Don&lt;span class=&#34;string&#34;&gt;&amp;#x27;t log authenticated requests to certain non-resource URL paths.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - level: None&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    userGroups: [&amp;quot;system:authenticated&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    nonResourceURLs:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - &amp;quot;/api*&amp;quot; # Wildcard matching.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - &amp;quot;/version&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;  #&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; Log the request body of configmap changes &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; kube-system.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - level: Request&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - group: &amp;quot;&amp;quot; # core API group&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      resources: [&amp;quot;configmaps&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    # This rule only applies to resources in the &amp;quot;kube-system&amp;quot; namespace.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    # The empty string &amp;quot;&amp;quot; can be used to select non-namespaced resources.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    namespaces: [&amp;quot;kube-system&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;  #&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; Log configmap and secret changes &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; all other namespaces at the Metadata level.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - level: Metadata&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - group: &amp;quot;&amp;quot; # core API group&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      resources: [&amp;quot;secrets&amp;quot;, &amp;quot;configmaps&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;  #&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; Log all other resources &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; core and extensions at the Request level.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - level: Request&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - group: &amp;quot;&amp;quot; # core API group&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - group: &amp;quot;extensions&amp;quot; # Version of group should NOT be included.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;  #&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; A catch-all rule to &lt;span class=&#34;built_in&#34;&gt;log&lt;/span&gt; all other requests at the Metadata level.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - level: Metadata&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    # Long-running requests like watches that fall under this rule will not&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    # generate an audit event in RequestReceived.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    omitStages:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - &amp;quot;RequestReceived&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;配置启动脚本&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vim /opt/kubernetes/server/bin/kube-apiserver-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /opt/kubernetes/server/bin/kube-apiserver-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;!/bin/bash&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/opt/kubernetes/server/bin/kube-apiserver \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --apiserver-count 2 \   #集群中运行的apiserver的数量&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --audit-log-path /data/logs/kubernetes/kube-apiserver/audit-log \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --audit-policy-file ../../conf/audit.yaml \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --authorization-mode RBAC \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --client-ca-file ./certs/ca.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --requestheader-client-ca-file ./certs/ca.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --enable-admission-plugins NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --etcd-cafile ./certs/ca.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --etcd-certfile ./certs/client.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --etcd-keyfile ./certs/client-key.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --etcd-servers https://192.168.31.1:2379,https://192.168.31.2:2379,https://192.168.31.3:2379 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --service-account-key-file ./certs/ca-key.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --service-cluster-ip-range 192.168.0.0/16 \    #server内部网段&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --service-node-port-range 3000-29999 \         # 对外暴露端口范围   默认30000-32767&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --target-ram-mb=1024 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --kubelet-client-certificate ./certs/client.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --kubelet-client-key ./certs/client-key.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --log-dir  /data/logs/kubernetes/kube-apiserver \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --tls-cert-file ./certs/apiserver.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --tls-private-key-file ./certs/apiserver-key.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --v 2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;配置 supervisor 启动配置&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vim /etc/supervisord.d/kube-apiserver.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /etc/supervisord.d/kube-apiserver.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[program:kube-apiserver-31.2]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;command=/opt/kubernetes/server/bin/kube-apiserver-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;numprocs=1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;directory=/opt/kubernetes/server/bin&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;autostart=true&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;autorestart=true&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;startsecs=30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;startretries=3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;exitcodes=0,2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stopsignal=QUIT&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stopwaitsecs=10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;user=root&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;redirect_stderr=true&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile=/data/logs/kubernetes/kube-apiserver/apiserver.stdout.log&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile_maxbytes=64MB&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile_backups=5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_capture_maxbytes=1MB&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_events_enabled=false&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;注意 logfile目录要手动创建 不然启动不了&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mkdir -p /data/logs/kubernetes/kube-apiserver/  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;supervisorctl update&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;在 192.168.31.2 上面安装 nginx 做 apiserver 负载均衡 (证书里面必须包含 nginx 主机 ip)&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;配置如下&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;stream &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    upstream kube-apiserver &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        server 192.168.31.2:6443     max_fails=3 fail_timeout=30s;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        server 192.168.31.3:6443     max_fails=3 fail_timeout=30s;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        listen 7443;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        proxy_connect_timeout 2s;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        proxy_timeout 900s;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        proxy_pass kube-apiserver;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        access_log /var/log/nginx/proxy.log proxy;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;安装controller-manager&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#安装controller-manager&#34;&gt;#&lt;/a&gt; 安装 controller-manager&lt;/h5&gt;
&lt;blockquote&gt;
&lt;p&gt;1. 配置启动脚本&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vim /opt/kubernetes/server/bin/kube-controller-manager-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /opt/kubernetes/server/bin/kube-controller-manager-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;!/bin/sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/opt/kubernetes/server/bin/kube-controller-manager \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --cluster-cidr 172.7.0.0/16 \    #pod网段&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --leader-elect true \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --log-dir /data/logs/kubernetes/kube-controller-manager \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --master http://127.0.0.1:8080 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --service-account-private-key-file ./certs/ca-key.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --service-cluster-ip-range 192.168.0.0/16 \  #server网段&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --root-ca-file ./certs/ca.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --v 2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;运行权限&lt;/span&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;chmod u+x /opt/kubernetes/server/bin/kube-controller-manager-startup.sh&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;配置 supervisor 启动配置&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vim /etc/supervisord.d/kube-controller-manager.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /etc/supervisord.d/kube-controller-manager.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[program:kube-controller-manager-31-2]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;command=/opt/kubernetes/server/bin/kube-controller-manager-startup.sh             ; the program (relative uses PATH, can take args)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;numprocs=1                                                                        ; number of processes copies to start (def 1)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;directory=/opt/kubernetes/server/bin                                              ; directory to cwd to before exec (def no cwd)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;autostart=true                                                                    ; start at supervisord start (default: true)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;autorestart=true                                                                  ; retstart at unexpected quit (default: true)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;startsecs=30                                                                      ; number of secs prog must stay running (def. 1)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;startretries=3                                                                    ; max # of serial start failures (default 3)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;exitcodes=0,2                                                                     ; &amp;#x27;expected&amp;#x27; exit codes for process (default 0,2)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stopsignal=QUIT                                                                   ; signal used to kill process (default TERM)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stopwaitsecs=10                                                                   ; max num secs to wait b4 SIGKILL (default 10)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;user=root                                                                         ; setuid to this UNIX account to run the program&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;redirect_stderr=true                                                              ; redirect proc stderr to stdout (default false)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile=/data/logs/kubernetes/kube-controller-manager/controller.stdout.log  ; stderr log path, NONE for none; default AUTO&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile_maxbytes=64MB                                                      ; max # logfile bytes b4 rotation (default 50MB)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile_backups=4                                                          ; # of stdout logfile backups (default 10)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_capture_maxbytes=1MB                                                       ; number of bytes in &amp;#x27;capturemode&amp;#x27; (default 0)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_events_enabled=false                                                       ; emit events on stdout writes (default false)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;supervisorctl update&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;安装kube-scheduler&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#安装kube-scheduler&#34;&gt;#&lt;/a&gt; 安装 kube-scheduler&lt;/h5&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;创建启动脚本&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vim /opt/kubernetes/server/bin/kube-scheduler-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /opt/kubernetes/server/bin/kube-scheduler-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;!/bin/sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/opt/kubernetes/server/bin/kube-scheduler \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --leader-elect  \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --log-dir /data/logs/kubernetes/kube-scheduler \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --master http://127.0.0.1:8080 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --v 2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;运行权限&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; chmod u+x /opt/kubernetes/server/bin/kube-scheduler-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;log&lt;/span&gt; 目录&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mkdir -p /data/logs/kubernetes/kube-scheduler&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;配置 supervisor 启动配置&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vim /etc/supervisord.d/kube-scheduler.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /etc/supervisord.d/kube-scheduler.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[program:kube-scheduler-31-2]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;command=/opt/kubernetes/server/bin/kube-scheduler-startup.sh                     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;numprocs=1                                                               &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;directory=/opt/kubernetes/server/bin                                     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;autostart=true                                                           &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;autorestart=true                                                         &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;startsecs=30                                                             &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;startretries=3                                                           &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;exitcodes=0,2                                                            &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stopsignal=QUIT                                                          &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stopwaitsecs=10                                                          &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;user=root                                                                &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;redirect_stderr=true                                                     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile=/data/logs/kubernetes/kube-scheduler/scheduler.stdout.log &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile_maxbytes=64MB                                             &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile_backups=4                                                 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_capture_maxbytes=1MB                                              &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_events_enabled=false &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;创建&lt;span class=&#34;built_in&#34;&gt;log&lt;/span&gt;目录&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mkdir  -p /data/logs/kubernetes/kube-scheduler/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;supervisorctl update&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;查看主控节点状态&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;kubectl get cs&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;kubelet-部署&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#kubelet-部署&#34;&gt;#&lt;/a&gt; kubelet 部署&lt;/h5&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;签发证书&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vim kubelet-csr.json &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat kubelet-csr.json &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;CN&amp;quot;: &amp;quot;k8s-kubelet&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;hosts&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;127.0.0.1&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;192.168.31.2&amp;quot;, #所有安装kubelet的主机ip&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;192.168.31.3&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    ],&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;key&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;algo&amp;quot;: &amp;quot;rsa&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;size&amp;quot;: 2048&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;names&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;C&amp;quot;: &amp;quot;CN&amp;quot;,  # 国家&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;ST&amp;quot;: &amp;quot;jiangsu&amp;quot;, #州或者是省份&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;L&amp;quot;: &amp;quot;jiangsu&amp;quot;, #地区，城市&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;O&amp;quot;: &amp;quot;k8s&amp;quot;, #组织名称，公司名称&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;OU&amp;quot;: &amp;quot;System&amp;quot; #组织单位名称，公司部门&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    ]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;签发证书&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kubelet-csr.json | cfssl-json -bare kubelet&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;将证书ca.pem kubelet.pem kubelet-key.pem复制到安装kubelet主机的/opt/kubernetes/server/bin/certs/目录 &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;2. 创建 kubelet 配置&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;set-cluster  # 创建需要连接的集群信息，可以创建多个k8s集群信息&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl config set-cluster myk8s \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--certificate-authority=/opt/kubernetes/server/bin/certs/ca.pem \  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--embed-certs=true \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--server=https://192.168.31.2:7443 \   #nginx负载api-server的主机&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--kubeconfig=/opt/kubernetes/conf/kubelet.kubeconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;set-credentials  # 创建用户账号，即用户登陆使用的客户端私有和证书，可以创建多个证书&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; kubectl kubectl config set-credentials k8s-node \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--client-certificate=/opt/kubernetes/server/bin/certs/client.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--client-key=/opt/kubernetes/server/bin/certs/client-key.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--embed-certs=true \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--kubeconfig=/opt/kubernetes/conf/kubelet.kubeconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;set-context  # 设置context，即确定账号和集群对应关&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl config set-context myk8s-context \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--cluster=myk8s \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--user=k8s-node \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--kubeconfig=/opt/kubernetes/conf/kubelet.kubeconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;use-context  # 设置当前使用哪个context&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl config use-context myk8s-context --kubeconfig=/opt/kubernetes/conf/kubelet.kubeconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;将kubelet.kubeconfig传给另一台就不用做以上四步  目录/opt/kubernetes/conf/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;授权 k8s-node 用户&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; 只需要在一台master节点执行&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vim k8s-node.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat  k8s-node.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: ClusterRoleBinding&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: k8s-node&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;roleRef:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  apiGroup: rbac.authorization.k8s.io&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  kind: ClusterRole&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: system:node&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;subjects:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;- apiGroup: rbac.authorization.k8s.io&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  kind: User&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: k8s-node&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl create -f k8s-node.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl get clusterrolebinding k8s-node&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;装备 pause 镜像&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;docker image pull kubernetes/pause&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;docker image tag kubernetes/pause:latest 个人镜像地址/public/pause:latest&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;docker login -u admin 个人镜像地址&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;docker image push 个人镜像地址/public/pause:latest&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;5. 创建启动脚本&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt; vim /opt/kubernetes/server/bin/kubelet-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; cat /opt/kubernetes/server/bin/kubelet-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt; #&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;!/bin/sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; /opt/kubernetes/server/bin/kubelet \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --anonymous-auth=false \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --cgroup-driver systemd \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --cluster-dns 192.168.0.2 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --cluster-domain cluster.local \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --runtime-cgroups=/systemd/system.slice \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --kubelet-cgroups=/systemd/system.slice \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --fail-swap-on=&amp;quot;false&amp;quot; \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --client-ca-file ./certs/ca.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --tls-cert-file ./certs/kubelet.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --tls-private-key-file ./certs/kubelet-key.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --hostname-override 主机名称 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --image-gc-high-threshold 20 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --image-gc-low-threshold 10 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --kubeconfig ../../conf/kubelet.kubeconfig \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --log-dir /data/logs/kubernetes/kube-kubelet \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --pod-infra-container-image 个人镜像地址/public/pause:latest \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    --root-dir /data/kubelet&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;chmod u+x /opt/kubernetes/server/bin/kubelet-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mkdir -p /data/logs/kubernetes/kube-kubelet /data/kubelet&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vim /etc/supervisord.d/kube-kubelet.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /etc/supervisord.d/kube-kubelet.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[program:kube-kubelet-31-2]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;command=/opt/kubernetes/server/bin/kubelet-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;numprocs=1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;directory=/opt/kubernetes/server/bin&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;autostart=true&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;autorestart=true&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;startsecs=30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;startretries=3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;exitcodes=0,2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stopsignal=QUIT&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stopwaitsecs=10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;user=root&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;redirect_stderr=true&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile=/data/logs/kubernetes/kube-kubelet/kubelet.stdout.log&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile_maxbytes=64MB&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile_backups=5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_capture_maxbytes=1MB&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_events_enabled=false&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;supervisorctl update&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;查看node&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl get node&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;修改节点角色&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;kubectl get node&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl label node 31.2.com node-role.kubernetes.io/node     # node角色&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl label node 31.2.com node-role.kubernetes.io/master=  #master角色&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl label node 31.3.com node-role.kubernetes.io/node&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl label node 31.3.com node-role.kubernetes.io/master=&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;kube-proxy部署&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#kube-proxy部署&#34;&gt;#&lt;/a&gt; kube-proxy 部署&lt;/h5&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;签发证书&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vim kube-proxy-csr.json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat kube-proxy-csr.json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;CN&amp;quot;: &amp;quot;system:kube-proxy&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;key&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;algo&amp;quot;: &amp;quot;rsa&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;size&amp;quot;: 2048&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;names&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;C&amp;quot;: &amp;quot;CN&amp;quot;,  # 国家&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;ST&amp;quot;: &amp;quot;jiangsu&amp;quot;, #州或者是省份&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;L&amp;quot;: &amp;quot;jiangsu&amp;quot;, #地区，城市&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;O&amp;quot;: &amp;quot;k8s&amp;quot;, #组织名称，公司名称&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;OU&amp;quot;: &amp;quot;System&amp;quot; #组织单位名称，公司部门&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    ]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json |cfssl-json -bare kube-proxy-client&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;将 kube-proxy-client-key.pem kube-proxy-client.pem  复制到31.2 与31.3主机   /opt/kubernetes/server/bin/certs/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;创建 kube-proxy 配置&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;kubectl config set-cluster myk8s \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--certificate-authority=/opt/kubernetes/server/bin/certs/ca.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--embed-certs=true \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--server=https://192.168.31.2:7443 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--kubeconfig=/opt/kubernetes/conf/kube-proxy.kubeconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl config set-credentials kube-proxy \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--client-certificate=/opt/kubernetes/server/bin/certs/kube-proxy-client.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--client-key=/opt/kubernetes/server/bin/certs/kube-proxy-client-key.pem \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--embed-certs=true \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--kubeconfig=/opt/kubernetes/conf/kube-proxy.kubeconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl config set-context myk8s-context \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--cluster=myk8s \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--user=kube-proxy \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--kubeconfig=/opt/kubernetes/conf/kube-proxy.kubeconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl config use-context myk8s-context --kubeconfig=/opt/kubernetes/conf/kube-proxy.kubeconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; 把kube-proxy.kubeconfig传到另一台机器 ,那边就可以不用做以上四步&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;加载 ipvs 模块&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;for i in $(ls /usr/lib/modules/$(uname -r)/kernel/net/netfilter/ipvs|grep -o &amp;quot;^[^.]*&amp;quot;);do echo $i; /sbin/modinfo -F filename $i &amp;gt;/dev/null 2&amp;gt;&amp;amp;1 &amp;amp;&amp;amp; /sbin/modprobe $i;done&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; 查看ipvs模块&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;lsmod | grep ip_vs  &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;创建启动脚本&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vim /opt/kubernetes/server/bin/kube-proxy-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /opt/kubernetes/server/bin/kube-proxy-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;!/bin/sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/opt/kubernetes/server/bin/kube-proxy \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --cluster-cidr 172.7.0.0/16 \   # pod网段&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --hostname-override 主机名称 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --proxy-mode=ipvs \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --ipvs-scheduler=nq \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --kubeconfig ../../conf/kube-proxy.kubeconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; chmod u+x  /opt/kubernetes-v1.15.2/server/bin/kube-proxy-startup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; mkdir -p /data/logs/kubernetes/kube-proxy&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vim /etc/supervisord.d/kube-proxy.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; cat /etc/supervisord.d/kube-proxy.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[program:kube-proxy-31-2]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;command=/opt/kubernetes/server/bin/kube-proxy-startup.sh                &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;numprocs=1                                                      &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;directory=/opt/kubernetes/server/bin                            &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;autostart=true                                                  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;autorestart=true                                                &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;startsecs=30                                                    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;startretries=3                                                  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;exitcodes=0,2                                                   &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stopsignal=QUIT                                                 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stopwaitsecs=10                                                 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;user=root                                                       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;redirect_stderr=true                                            &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile=/data/logs/kubernetes/kube-proxy/proxy.stdout.log&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile_maxbytes=64MB                                    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile_backups=5                                       &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_capture_maxbytes=1MB                                     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_events_enabled=false&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;supervisorctl update&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;5. 验证集群&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;kubectl get svc&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vi nginx-test.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat nginx-test.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: extensions/v1beta1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: Deployment&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    name: nginx-test&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    template:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        labels:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          app: nginx-test&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        containers:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - name: my-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          image: 个人镜像地址/public/nginx:v1.7.9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          ports:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          - containerPort: 80  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; kubectl create -f  nginx-test.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; kubectl get pods&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; kubectl get pods -o  wide 获取详情信息&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;安装flannel使pod可以跨主机通信&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#安装flannel使pod可以跨主机通信&#34;&gt;#&lt;/a&gt; 安装 flannel 使 pod 可以跨主机通信&lt;/h5&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;下载&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;wget &amp;quot;https://github.com/coreos/flannel/releases/download/v0.11.0/flannel-v0.11.0-linux-amd64.tar.gz&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tar xf flannel-v0.11.0-linux-amd64.tar.gz -C /opt/flannel&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;拷贝 ca.pem  ca.pem client-key.pem 证书到 /opt/flannel/cert&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;配置文件 &amp;amp; 启动脚本&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt; vi flanneld.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; cat flanneld.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt; #&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;!/bin/sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;./flanneld &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --public-ip=192.168.31.2 \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --etcd-endpoints=https://192.168.31.1:2379,https://192.168.31.2:2379,https://192.168.31.3:2379 \ &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --etcd-keyfile=./cert/client-key.pem &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --etcd-certfile=./cert/client.pem &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --etcd-cafile=./cert/ca.pem &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --iface=eth0 \  #网卡&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  --healthz-port=2401&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;chmod u+x flanneld.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;4. 设置 vxlan 模型&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;etcdctl ls coreos.com/network/config/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;etcdctl rm /coreos.com/network/config&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;etcdctl ls coreos.com/network/subnets/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;etcdctl rm /coreos.com/network/subnets/172.7.30.0-24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;etcdctl rm /coreos.com/network/subnets/172.7.40.0-24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;etcdctl set /coreos.com/network/config &amp;#x27;&amp;#123;&amp;quot;Network&amp;quot;: &amp;quot;172.7.0.0/16&amp;quot;, &amp;quot;Backend&amp;quot;: &amp;#123;&amp;quot;Type&amp;quot;: &amp;quot;VxLAN&amp;quot;&amp;#125;&amp;#125;&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;etcdctl get /coreos.com/network/config&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;5. 启动 flannel&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vim /etc/supervisord.d/flannel.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /etc/supervisord.d/flannel.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[program:flanneld-31-2]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;command=/opt/flannel/flanneld.sh                             ; the program (relative uses PATH, can take args)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;numprocs=1                                                   ; number of processes copies to start (def 1)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;directory=/opt/flannel                                       ; directory to cwd to before exec (def no cwd)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;autostart=true                                               ; start at supervisord start (default: true)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;autorestart=true                                             ; retstart at unexpected quit (default: true)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;startsecs=30                                                 ; number of secs prog must stay running (def. 1)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;startretries=3                                               ; max # of serial start failures (default 3)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;exitcodes=0,2                                                ; &amp;#x27;expected&amp;#x27; exit codes for process (default 0,2)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stopsignal=QUIT                                              ; signal used to kill process (default TERM)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stopwaitsecs=10                                              ; max num secs to wait b4 SIGKILL (default 10)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;user=root                                                    ; setuid to this UNIX account to run the program&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;redirect_stderr=true                                         ; redirect proc stderr to stdout (default false)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile=/data/logs/flanneld/flanneld.stdout.log       ; stderr log path, NONE for none; default AUTO&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile_maxbytes=64MB                                 ; max # logfile bytes b4 rotation (default 50MB)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_logfile_backups=4                                     ; # of stdout logfile backups (default 10)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_capture_maxbytes=1MB                                  ; number of bytes in &amp;#x27;capturemode&amp;#x27; (default 0)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;stdout_events_enabled=false                                  ; emit events on stdout writes (default false)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mkdir -p /data/logs/flanneld/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;supervisorctl update&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;查看路由&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;route -n&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;docker 设置 flannel 网络&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vi /etc/docker/daemon.json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; flannel网段&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;bip&amp;quot;: &amp;quot;172.7.40.1/24&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;重启dockers&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;systemctl daemon-reload&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;systemctl restart docker&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;部署ingress-nginx使外部网络可以访问&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#部署ingress-nginx使外部网络可以访问&#34;&gt;#&lt;/a&gt; 部署 ingress-nginx 使外部网络可以访问&lt;/h5&gt;
&lt;blockquote&gt;
&lt;p&gt;地址:&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL2t1YmVybmV0ZXMvaW5ncmVzcy1uZ2lueA==&#34;&gt;https://github.com/kubernetes/ingress-nginx&lt;/span&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;151&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;152&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;153&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;154&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;155&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;156&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;157&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;158&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;159&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;160&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;161&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;162&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;163&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;164&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;165&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;166&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;167&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;168&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;169&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;170&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;171&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;172&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;173&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;174&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;175&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;176&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;177&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;178&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;179&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;180&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;181&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;182&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;183&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;184&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;185&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;186&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;187&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;188&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;189&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;190&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;191&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;192&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;193&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;194&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;195&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;196&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;197&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;198&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;199&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;200&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;201&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;202&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;203&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;204&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;205&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;206&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;207&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;208&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;209&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;210&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;211&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;212&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;213&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;214&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;215&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;216&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;217&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;218&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;219&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;220&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;221&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;222&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;223&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;224&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;225&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;226&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;227&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;228&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;229&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;230&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;231&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;232&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;233&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;234&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;235&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;236&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;237&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;238&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;239&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;240&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;241&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;242&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;243&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;244&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;245&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;246&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;247&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;248&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;249&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;250&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;251&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;252&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;253&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;254&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;255&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;256&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;257&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;258&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;259&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;260&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;261&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;262&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;263&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;264&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;265&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;266&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;267&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;268&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;269&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;270&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;271&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;272&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;273&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;274&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;275&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;276&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;277&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;278&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;279&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;280&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;281&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;282&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;283&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;284&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;285&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;286&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;287&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;288&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;289&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;290&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;291&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;292&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;293&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;294&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;295&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;296&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;297&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;298&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;299&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;300&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;301&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;302&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;303&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;304&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;305&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;306&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;307&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;308&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;309&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;310&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;311&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;312&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;313&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;314&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;315&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;316&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;317&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;318&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;319&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;320&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;321&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;322&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;323&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;324&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;325&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;326&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;327&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;328&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;329&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;330&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;331&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;332&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;333&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;334&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;335&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;336&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;337&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;338&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;339&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;340&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;341&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;342&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;343&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;344&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;345&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;346&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;347&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;348&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;349&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;350&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;351&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;352&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;353&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;354&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;355&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;356&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;357&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;358&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;359&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;360&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;361&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;362&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;363&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;364&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;365&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;366&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;367&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;368&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;369&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;370&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;371&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;372&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;373&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;374&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;375&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;376&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;377&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;378&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;379&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;380&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;381&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;382&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;383&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;384&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;385&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;386&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;387&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;388&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;389&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;390&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;391&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;392&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;393&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;394&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;395&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;396&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;397&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;398&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;399&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;400&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;401&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;402&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;403&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;404&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;405&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;406&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;407&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;408&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;409&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat mandatory.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;--------------------- namespaces -----------------------&lt;span class=&#34;comment&#34;&gt;#&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: v1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: Namespace&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;--------------------- ConfigMap--------------------------&lt;span class=&#34;comment&#34;&gt;#&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: ConfigMap&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: v1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: nginx-configuration&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  namespace: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  labels:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    app: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: ConfigMap&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: v1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: tcp-services&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  namespace: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: ConfigMap&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: v1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: udp-services&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  namespace: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: v1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: ConfigMap&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: nginx-load-balancer-conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;data:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  enable-vts-status: &amp;quot;true&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;---------------------------rbac--------------------------&lt;span class=&#34;comment&#34;&gt;#&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: v1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: ServiceAccount&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: nginx-ingress-serviceaccount&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  namespace: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: rbac.authorization.k8s.io/v1beta1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: ClusterRole&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: nginx-ingress-clusterrole&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rules:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - apiGroups:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - &amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - configmaps&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - endpoints&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - nodes&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - pods&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - secrets&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    verbs:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - list&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - watch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - apiGroups:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - &amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - nodes&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    verbs:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - get&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - apiGroups:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - &amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - services&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    verbs:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - get&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - list&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - watch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - apiGroups:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - &amp;quot;extensions&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - ingresses&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    verbs:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - get&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - list&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - watch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - apiGroups:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - &amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - events&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    verbs:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - create&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - patch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - apiGroups:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - &amp;quot;extensions&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - ingresses/status&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    verbs:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - update&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: rbac.authorization.k8s.io/v1beta1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: Role&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: nginx-ingress-role&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  namespace: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rules:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - apiGroups:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - &amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - configmaps&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - pods&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - secrets&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - namespaces&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    verbs:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - get&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - apiGroups:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - &amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - configmaps&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resourceNames:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      # Defaults to &amp;quot;&amp;lt;election-id&amp;gt;-&amp;lt;ingress-class&amp;gt;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      # Here: &amp;quot;&amp;lt;ingress-controller-leader&amp;gt;-&amp;lt;nginx&amp;gt;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      # This has to be adapted if you change either parameter&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      # when launching the nginx-ingress-controller.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - &amp;quot;ingress-controller-leader-nginx&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    verbs:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - get&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - update&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - apiGroups:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - &amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - configmaps&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    verbs:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - create&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - apiGroups:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - &amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - endpoints&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    verbs:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - get&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: rbac.authorization.k8s.io/v1beta1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: RoleBinding&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: nginx-ingress-role-nisa-binding&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  namespace: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;roleRef:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  apiGroup: rbac.authorization.k8s.io&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  kind: Role&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: nginx-ingress-role&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;subjects:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - kind: ServiceAccount&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    name: nginx-ingress-serviceaccount&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    namespace: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: rbac.authorization.k8s.io/v1beta1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: ClusterRoleBinding&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: nginx-ingress-clusterrole-nisa-binding&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;roleRef:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  apiGroup: rbac.authorization.k8s.io&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  kind: ClusterRole&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: nginx-ingress-clusterrole&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;subjects:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - kind: ServiceAccount&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    name: nginx-ingress-serviceaccount&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    namespace: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;------------------------nginx-controller-----------------&lt;span class=&#34;comment&#34;&gt;#&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: extensions/v1beta1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: Deployment&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: nginx-ingress-controller&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  namespace: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  replicas: 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  selector:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    matchLabels:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      app: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  template:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      labels:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        app: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      annotations:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        prometheus.io/port: &amp;#x27;10254&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        prometheus.io/scrape: &amp;#x27;true&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      serviceAccountName: nginx-ingress-serviceaccount&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      hostNetwork: true&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      containers:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - name: nginx-ingress-controller&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          image: 个人镜像地址/public/nginx-ingress-controller:0.20.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          args:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            - /nginx-ingress-controller&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            - --default-backend-service=$(POD_NAMESPACE)/default-http-backend&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            - --configmap=$(POD_NAMESPACE)/nginx-configuration&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            - --tcp-services-configmap=$(POD_NAMESPACE)/tcp-services&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            - --udp-services-configmap=$(POD_NAMESPACE)/udp-services&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            - --publish-service=$(POD_NAMESPACE)/nginx-ingress-controller&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            - --annotations-prefix=nginx.ingress.kubernetes.io&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          env:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            - name: POD_NAME&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              valueFrom:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                fieldRef:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                  fieldPath: metadata.name&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            - name: POD_NAMESPACE&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              valueFrom:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                fieldRef:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                  fieldPath: metadata.namespace&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          ports:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          - name: http&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            containerPort: 80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          - name: https&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            containerPort: 443&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          - containerPort: 8080&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            hostPort: 8080&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          livenessProbe:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            failureThreshold: 3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            httpGet:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              path: /healthz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              port: 10254&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              scheme: HTTP&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            initialDelaySeconds: 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            periodSeconds: 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            successThreshold: 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            timeoutSeconds: 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          readinessProbe:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            failureThreshold: 3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            httpGet:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              path: /healthz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              port: 10254&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              scheme: HTTP&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            periodSeconds: 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            successThreshold: 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            timeoutSeconds: 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          securityContext:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            runAsNonRoot: false&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: v1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: Service&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: nginx-ingress-controller&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  namespace: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  ports:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - port: 80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    protocol: TCP&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    targetPort: 80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    name: http&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - port: 443&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    protocol: TCP&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    targetPort: 443&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    name: https&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - port: 8080&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    protocol: TCP&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    name: nginx-status&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  selector:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    k8s-app: nginx-ingress-controller&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  sessionAffinity: None&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  type: ClusterIP&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: Ingress&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: extensions/v1beta1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: nginx-status-ingress&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  namespace: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  rules:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - host: nginx-ui.local&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    http:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      paths:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - path:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        backend:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          serviceName: nginx-ingress-controller&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          servicePort: 8080&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;-----------------------default-http-backend--------------&lt;span class=&#34;comment&#34;&gt;#&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: v1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: ReplicationController&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: default-http-backend&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  namespace: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  replicas: 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  selector:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    app: default-http-backend&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  template:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      labels:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        app: default-http-backend&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      terminationGracePeriodSeconds: 60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      containers:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - name: default-http-backend&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        # Any image is permissable as long as:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        # 1. It serves a 404 page at /&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        # 2. It serves 200 on a /healthz endpoint&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        image: 个人镜像地址/public/defaultbackend-amd64:1.5   &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        livenessProbe:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          httpGet:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            path: /healthz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            port: 8080&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            scheme: HTTP&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          initialDelaySeconds: 30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          timeoutSeconds: 5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        ports:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - containerPort: 8080&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          limits:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            cpu: 10m&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            memory: 20Mi&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          requests:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            cpu: 10m&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            memory: 20Mi&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: v1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: Service&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: default-http-backend&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  namespace: ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  labels:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    app: default-http-backend&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  ports:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - port: 80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    targetPort: 8080&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  selector:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    app: default-http-backend&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl create -f  mandatory.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl get pod -o wide -n ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;部署nginx&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl create -f  nginx-test.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat nginx-test.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: extensions/v1beta1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: Deployment&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    name: nginx-test&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    template:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        labels:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          app: nginx-test&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        containers:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - name: my-nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          image: 个人镜像地址/public/nginx:v1.7.9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          ports:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          - containerPort: 80  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;创建nginx-svc&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat nginx-svc.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: v1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: Service&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: nginx-svc&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  selector:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    app: nginx-test&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  ports:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - port: 80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    protocol: TCP&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    targetPort: 80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl create -f  nginx-svc.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;对外暴露端口&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat   test-nginx-ingress.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: extensions/v1beta1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: Ingress&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: nginx-svc&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;   tls:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;     - secretName: test-nginx&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  rules:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - host: 域名&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    http:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      paths:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - path: /&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        backend:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          serviceName: nginx-svc&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          servicePort: 80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl create -f  test-nginx-ingress.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;查看部署情况&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl get ing&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;通过域名即可访问nginx&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://www.startanew.cn/2021/07/25/k8s%20%20kubeadmin%E5%AE%89%E8%A3%85/</guid>
            <title>k8s kubeadmin安装</title>
            <link>http://www.startanew.cn/2021/07/25/k8s%20%20kubeadmin%E5%AE%89%E8%A3%85/</link>
            <category>other</category>
            <pubDate>Sun, 25 Jul 2021 17:09:18 +0800</pubDate>
            <description><![CDATA[ &lt;h5 id=&#34;集群架构-学习记录&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#集群架构-学习记录&#34;&gt;#&lt;/a&gt; 集群架构  (学习记录)&lt;/h5&gt;
&lt;blockquote&gt;
&lt;p&gt;一个 master 一个 node&lt;br&gt;
192.168.31.1 master&lt;br&gt;
192.168.31.2 node&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5 id=&#34;基础环境设置&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#基础环境设置&#34;&gt;#&lt;/a&gt; 基础环境设置&lt;/h5&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;设置主机名&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;主机ip:192.168.31.1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;hostnamectl set-hostname master&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;主机ip:192.168.31.2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;hostnamectl set-hostname node&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;关闭防火墙和 selinux&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;systemctl stop firewalld&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;systemctl disable firewalld&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;setenforce 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sed -i &amp;quot;s/SELINUX=enforcing/SELINUX=disabled/g&amp;quot; /etc/selinux/config&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swapoff -a &amp;amp;&amp;amp; sed -i &amp;#x27;/ swap / s/^\(.*\)$/#\1/g&amp;#x27; /etc/fstab&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;设置 yum 源&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;wget -O /etc/yum.repos.d/CentOS-Base.repo  http://mirrors.aliyun.com/repo/Centos-7.repo&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;wget -O /etc/yum.repos.d/epel.repo  http://mirrors.aliyun.com/repo/epel-7.repo&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;yum clean all&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;yum makecache&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;常用工具安装&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;yum install wget net-tools telnet tree nmap sysstat lrzsz dos2unix bind-utils -y&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;安装 docker&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;yum install -y docker-ce&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vim /etc/docker/daemon.json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;设置个人镜像仓库&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;quot;insecure-registries&amp;quot;: [&amp;quot;仓库地址&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;  开启docker&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; systemctl start docker ; systemctl enable docker&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;调整内核参数&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;modprobe br_netfilter&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat &amp;lt;&amp;lt;EOF&amp;gt; kubernetes.conf &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;net.bridge.bridge-nf-call-iptables=1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;net.bridge.bridge-nf-call-ip6tables=1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;net.ipv4.ip_forward=1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;net.ipv4.tcp_tw_recycle=0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vm.swappiness=0 # 禁止使用 swap 空间，只有当系统 OOM 时才允许使用它&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vm.overcommit_memory=1 # 不检查物理内存是否够用&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vm.panic_on_oom=0 # 开启 OOM&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fs.inotify.max_user_instances=8192&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fs.inotify.max_user_watches=1048576&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fs.file-max=52706963&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fs.nr_open=52706963&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;net.ipv6.conf.all.disable_ipv6=1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;net.netfilter.nf_conntrack_max=2310720&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;EOF&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cp kubernetes.conf /etc/sysctl.d/kubernetes.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sysctl -p /etc/sysctl.d/kubernetes.conf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;调整系统时区&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; 设置系统时区为 中国/上海&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;timedatectl set-timezone Asia/Shanghai&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; 将当前的 UTC 时间写入硬件时钟&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;timedatectl set-local-rtc 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; 重启依赖于系统时间的服务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;systemctl restart rsyslog&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;systemctl restart crond&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;8&#34;&gt;
&lt;li&gt;kube-proxy 开启 ipvs 的前置条件&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cat &amp;lt;&amp;lt;EOF&amp;gt; /etc/sysconfig/modules/ipvs.modules &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;!/bin/bash&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;modprobe -- ip_vs&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;modprobe -- ip_vs_rr&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;modprobe -- ip_vs_wrr&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;modprobe -- ip_vs_sh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;modprobe -- nf_conntrack_ipv4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;EOF&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;amp;&amp;amp; bash /etc/sysconfig/modules/ipvs.modules &amp;amp;&amp;amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;安装-kubeadm&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#安装-kubeadm&#34;&gt;#&lt;/a&gt; 安装 Kubeadm&lt;/h5&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;安装 Kubeadm&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cat &amp;lt;&amp;lt;EOF &amp;gt; /etc/yum.repos.d/kubernetes.repo&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[kubernetes]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;name=Kubernetes&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;enabled=1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;gpgcheck=1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;repo_gpgcheck=1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;EOF&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;setenforce 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;yum install -y kubelet kubeadm kubectl &amp;amp;&amp;amp; systemctl enable kubelet&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;初始化主节点&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;kubeadm init --apiserver-advertise-address=192.168.31.1 --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.21.1 --service-cidr=10.96.0.0/12 --pod-network-cidr=10.244.0.0/16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mkdir -p $HOME/.kube&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo chown $(id -u):$(id -g) $HOME/.kube/config&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;加入主节点&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;kubeadm join 192.168.31.1:6443 --token 2f5xrv.mhbj3aq4i75ytkri  \&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        --discovery-token-ca-cert-hash  sha256:da21afbb6a2eefce583ff3c8750330eef679d0874df15cbcb737a83241e98d60 &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;部署 flannel 网络&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;151&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;152&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;153&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;154&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;155&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;156&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;157&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;158&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;159&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;160&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;161&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;162&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;163&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;164&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;165&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;166&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;167&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;168&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;169&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;170&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;171&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;172&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;173&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;174&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;175&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;176&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;177&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;178&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;179&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;180&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;181&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;182&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;183&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;184&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;185&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;186&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;187&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;188&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;189&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;190&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;191&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;192&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;193&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;194&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;195&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;196&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;197&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;198&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;199&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;200&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;201&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;202&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;203&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;204&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;205&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;206&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;207&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;208&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;209&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;210&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;211&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;212&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;213&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;214&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;215&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;216&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;217&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;218&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;219&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;220&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;221&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;222&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;223&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;224&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;225&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;226&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;227&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;228&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat kube-flannel.yml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: policy/v1beta1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: PodSecurityPolicy&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: psp.flannel.unprivileged&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  annotations:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    seccomp.security.alpha.kubernetes.io/allowedProfileNames: docker/default&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    seccomp.security.alpha.kubernetes.io/defaultProfileName: docker/default&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    apparmor.security.beta.kubernetes.io/allowedProfileNames: runtime/default&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    apparmor.security.beta.kubernetes.io/defaultProfileName: runtime/default&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  privileged: false&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  volumes:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - configMap&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - secret&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - emptyDir&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - hostPath&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  allowedHostPaths:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - pathPrefix: &amp;quot;/etc/cni/net.d&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - pathPrefix: &amp;quot;/etc/kube-flannel&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - pathPrefix: &amp;quot;/run/flannel&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  readOnlyRootFilesystem: false&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;  #&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; Users and groups&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  runAsUser:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    rule: RunAsAny&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  supplementalGroups:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    rule: RunAsAny&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  fsGroup:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    rule: RunAsAny&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;  #&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; Privilege Escalation&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  allowPrivilegeEscalation: false&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  defaultAllowPrivilegeEscalation: false&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;  #&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; Capabilities&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  allowedCapabilities: [&amp;#x27;NET_ADMIN&amp;#x27;, &amp;#x27;NET_RAW&amp;#x27;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  defaultAddCapabilities: []&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  requiredDropCapabilities: []&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;  #&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; Host namespaces&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  hostPID: false&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  hostIPC: false&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  hostNetwork: true&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  hostPorts:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - min: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    max: 65535&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;  #&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; SELinux&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  seLinux:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    # SELinux is unused in CaaSP&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    rule: &amp;#x27;RunAsAny&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: ClusterRole&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: flannel&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rules:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;- apiGroups: [&amp;#x27;extensions&amp;#x27;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  resources: [&amp;#x27;podsecuritypolicies&amp;#x27;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  verbs: [&amp;#x27;use&amp;#x27;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  resourceNames: [&amp;#x27;psp.flannel.unprivileged&amp;#x27;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;- apiGroups:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - &amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - pods&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  verbs:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - get&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;- apiGroups:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - &amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - nodes&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  verbs:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - list&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - watch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;- apiGroups:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - &amp;quot;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - nodes/status&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  verbs:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - patch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: ClusterRoleBinding&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: flannel&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;roleRef:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  apiGroup: rbac.authorization.k8s.io&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  kind: ClusterRole&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: flannel&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;subjects:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;- kind: ServiceAccount&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: flannel&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  namespace: kube-system&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: v1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: ServiceAccount&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: flannel&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  namespace: kube-system&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: ConfigMap&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: v1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: kube-flannel-cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  namespace: kube-system&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  labels:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    tier: node&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    app: flannel&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;data:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  cni-conf.json: |&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &amp;quot;name&amp;quot;: &amp;quot;cbr0&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &amp;quot;cniVersion&amp;quot;: &amp;quot;0.3.1&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &amp;quot;plugins&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &amp;quot;type&amp;quot;: &amp;quot;flannel&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &amp;quot;delegate&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;hairpinMode&amp;quot;: true,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;isDefaultGateway&amp;quot;: true&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &amp;quot;type&amp;quot;: &amp;quot;portmap&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &amp;quot;capabilities&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;quot;portMappings&amp;quot;: true&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      ]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  net-conf.json: |&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &amp;quot;Network&amp;quot;: &amp;quot;10.244.0.0/16&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &amp;quot;Backend&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;Type&amp;quot;: &amp;quot;vxlan&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;apiVersion: apps/v1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kind: DaemonSet&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  name: kube-flannel-ds&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  namespace: kube-system&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  labels:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    tier: node&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    app: flannel&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  selector:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    matchLabels:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      app: flannel&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  template:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    metadata:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      labels:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        tier: node&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        app: flannel&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    spec:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      affinity:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        nodeAffinity:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          requiredDuringSchedulingIgnoredDuringExecution:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            nodeSelectorTerms:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            - matchExpressions:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              - key: kubernetes.io/os&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                operator: In&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                values:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                - linux&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      hostNetwork: true&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      priorityClassName: system-node-critical&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      tolerations:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - operator: Exists&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        effect: NoSchedule&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      serviceAccountName: flannel&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      initContainers:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - name: install-cni&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        image: quay.io/coreos/flannel:v0.14.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        command:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - cp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        args:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - -f&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - /etc/kube-flannel/cni-conf.json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - /etc/cni/net.d/10-flannel.conflist&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        volumeMounts:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - name: cni&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          mountPath: /etc/cni/net.d&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - name: flannel-cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          mountPath: /etc/kube-flannel/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      containers:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - name: kube-flannel&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        image: quay.io/coreos/flannel:v0.14.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        command:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - /opt/bin/flanneld&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        args:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - --ip-masq&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - --kube-subnet-mgr&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        resources:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          requests:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            cpu: &amp;quot;100m&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            memory: &amp;quot;50Mi&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          limits:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            cpu: &amp;quot;100m&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            memory: &amp;quot;50Mi&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        securityContext:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          privileged: false&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          capabilities:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            add: [&amp;quot;NET_ADMIN&amp;quot;, &amp;quot;NET_RAW&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        env:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - name: POD_NAME&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          valueFrom:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            fieldRef:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              fieldPath: metadata.name&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - name: POD_NAMESPACE&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          valueFrom:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            fieldRef:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              fieldPath: metadata.namespace&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        volumeMounts:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - name: run&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          mountPath: /run/flannel&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        - name: flannel-cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          mountPath: /etc/kube-flannel/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      volumes:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - name: run&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        hostPath:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          path: /run/flannel&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - name: cni&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        hostPath:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          path: /etc/cni/net.d&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      - name: flannel-cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        configMap:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          name: kube-flannel-cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;搭建 ingress 环境&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;mkdir ingress-controller&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cd ingress-controller/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/mandatory.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/baremetal/service-nodeport.yaml&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl apply -f ./&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; 查看ingress-nginx&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;kubectl get pod -n ingress-nginx&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://www.startanew.cn/2021/07/25/%E8%87%AA%E5%BB%BAdns/</guid>
            <title>自建dns</title>
            <link>http://www.startanew.cn/2021/07/25/%E8%87%AA%E5%BB%BAdns/</link>
            <category>other</category>
            <pubDate>Sun, 25 Jul 2021 16:34:55 +0800</pubDate>
            <description><![CDATA[ &lt;h3 id=&#34;自建dns学习笔记&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#自建dns学习笔记&#34;&gt;#&lt;/a&gt; 自建 dns（学习笔记）&lt;/h3&gt;
&lt;h5 id=&#34;bind安装&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#bind安装&#34;&gt;#&lt;/a&gt; bind 安装&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;yum install -y bind&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;修改主配置文件&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#修改主配置文件&#34;&gt;#&lt;/a&gt; 修改主配置文件&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vim /etc/named.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /etc/named.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// named.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// server as a caching only nameserver (as a localhost DNS resolver only).&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// See /usr/share/doc/bind*/sample/ for example named configuration files.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;options &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        listen-on port 53 &amp;#123; any; &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        directory       &amp;quot;/var/named&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        dump-file       &amp;quot;/var/named/data/cache_dump.db&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        statistics-file &amp;quot;/var/named/data/named_stats.txt&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        memstatistics-file &amp;quot;/var/named/data/named_mem_stats.txt&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        secroots-file   &amp;quot;/var/named/data/named.secroots&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        recursing-file  &amp;quot;/var/named/data/named.recursing&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        allow-query     &amp;#123; any; &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        /*&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;         listen-on-v6 port 53 &amp;#123; any; &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;         - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;         - If you are building a RECURSIVE (caching) DNS server, you need to enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;           recursion.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;         - If your recursive DNS server has a public IP address, you MUST enable access&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;           control to limit queries to your legitimate users. Failing to do so will&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;           cause your server to become part of large scale DNS amplification&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;           attacks. Implementing BCP38 within your network would greatly&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;           reduce such attack surface&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        */&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        forwarders      &amp;#123; 192.168.31.254; &amp;#125;; #上级dns&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        recursion yes;   #采用递归方法查询IP&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        dnssec-enable no;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        dnssec-validation no;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        managed-keys-directory &amp;quot;/var/named/dynamic&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        pid-file &amp;quot;/run/named/named.pid&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        session-keyfile &amp;quot;/run/named/session.key&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        /* https://fedoraproject.org/wiki/Changes/CryptoPolicy */&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        include &amp;quot;/etc/crypto-policies/back-ends/bind.config&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;logging &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        channel default_debug &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                file &amp;quot;data/named.run&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                severity dynamic;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;zone &amp;quot;.&amp;quot; IN &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        type hint;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        file &amp;quot;named.ca&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;include &amp;quot;/etc/named.rfc1912.zones&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;include &amp;quot;/etc/named.root.key&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;配置区域文件-添加增加两个zone配置odcom为业务域hostcomzone为主机域&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#配置区域文件-添加增加两个zone配置odcom为业务域hostcomzone为主机域&#34;&gt;#&lt;/a&gt; 配置区域文件  添加增加两个 zone 配置，od.com 为业务域，host.com.zone 为主机域&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vim /etc/named.rfc1912.zones&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /etc/named.rfc1912.zones&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// named.rfc1912.zones:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// Provided by Red Hat caching-nameserver package&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// ISC BIND named zone configuration for zones recommended by&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// RFC 1912 section 4.1 : localhost TLDs and address zones&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// and https://tools.ietf.org/html/rfc6303&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// (c)2007 R W Franks&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// See /usr/share/doc/bind*/sample/ for example named configuration files.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// Note: empty-zones-enable yes; option is default.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// If private ranges should be forwarded, add&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;// disable-empty-zone &amp;quot;.&amp;quot;; into options&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;zone &amp;quot;localhost.localdomain&amp;quot; IN &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        type master;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        file &amp;quot;named.localhost&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        allow-update &amp;#123; none; &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;zone &amp;quot;localhost&amp;quot; IN &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        type master;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        file &amp;quot;named.localhost&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        allow-update &amp;#123; none; &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;zone &amp;quot;1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa&amp;quot; IN &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        type master;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        file &amp;quot;named.loopback&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        allow-update &amp;#123; none; &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;zone &amp;quot;1.0.0.127.in-addr.arpa&amp;quot; IN &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        type master;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        file &amp;quot;named.loopback&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        allow-update &amp;#123; none; &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;zone &amp;quot;0.in-addr.arpa&amp;quot; IN &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        type master;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        file &amp;quot;named.empty&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        allow-update &amp;#123; none; &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;zone &amp;quot;host.com&amp;quot; IN &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        type  master;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        file  &amp;quot;host.com.zone&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        allow-update &amp;#123; 10.4.7.11; &amp;#125;;  # 本机ip地址&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;zone &amp;quot;od.com&amp;quot; IN &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        type  master;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        file  &amp;quot;od.com.zone&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        allow-update &amp;#123; 10.4.7.11; &amp;#125;; # 本机ip地址&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;配置主机域文件&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#配置主机域文件&#34;&gt;#&lt;/a&gt; 配置主机域文件&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vim /var/named/host.com.zone&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /var/named/host.com.zone&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;ORIGIN host.com.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;TTL 600  ; 10 minutes&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;@       IN SOA  dns.host.com. dnsadmin.host.com. (&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        2021071101 ; serial    #2021年7月11日+序列号&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        10800      ; refresh (3 hours)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        900        ; retry (15 minutes)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        604800     ; expire (1 week)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        86400      ; minimum (1 day)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        )&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      NS   dns.host.com.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;TTL 60 ; 1 minute&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;dns                A    192.168.31.22 # 本机ip&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;test               A    192.168.31.23 #域名映射ip&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;配置业务域文件&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#配置业务域文件&#34;&gt;#&lt;/a&gt; 配置业务域文件&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vim /var/named/od.com.zone&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cat /var/named/od.com.zone&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;ORIGIN od.com.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;TTL 600  ; 10 minutes&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;@       IN SOA  dns.od.com. dnsadmin.od.com. (&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        2021071102 ; serial&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        10800      ; refresh (3 hours)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        900        ; retry (15 minutes)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        604800     ; expire (1 week)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        86400      ; minimum (1 day)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        )&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        NS   dns.od.com.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt;TTL 60 ; 1 minute&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;dns                A    192.168.31.22 # 本机ip&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;test               A    192.168.31.23 #域名映射ip&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;检查配置文件&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#检查配置文件&#34;&gt;#&lt;/a&gt; 检查配置文件&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;named-checkconf   # 无任何输出则正确&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;启动dns&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#启动dns&#34;&gt;#&lt;/a&gt; 启动 dns&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;systemctl start named &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;systemctl enable named&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;测试&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#测试&#34;&gt;#&lt;/a&gt; 测试&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;dig -t A test.host.com  @192.168.31.22 +shor # 输出域名对应ip&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;注意事项-关闭防火墙&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#注意事项-关闭防火墙&#34;&gt;#&lt;/a&gt; 注意事项  关闭防火墙&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;systemctl stop firewalld&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;systemctl disable firewalld&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;使用dns-示例&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#使用dns-示例&#34;&gt;#&lt;/a&gt; 使用 dns  示例&lt;/h5&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cat /etc/sysconfig/network-scripts/ifcfg-ens33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;TYPE=Ethernet&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;BOOTPROTO=none&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;NAME=ens33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;DEVICE=ens33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ONBOOT=yes&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;IPADDR=192.168.31.24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;NETMASK=255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;GATEWAY=192.168.31.254 # 网关&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;DNS1=192.168.31.22  #自建dns地址&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
 ]]></description>
        </item>
    </channel>
</rss>
